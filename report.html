<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Reports</title>
	<link href="graph_style.css" rel="stylesheet" type="text/css">
	<script language="javascript" type="text/javascript" src="js/flot/jquery.js"></script>
	<script language="javascript" type="text/javascript" src="js/flot/jquery.flot.js"></script>
	<script language="javascript" type="text/javascript" src="js/flot/jquery.flot.categories.js"></script>
	<script type="text/javascript">

    var count = [];
    var bug_count = [];
    
	$(function() {

		var data;// = d1
        var d2 = [];
        var d1 = [];
        var j=0;
        var k=0;
        var x1 = 0;
        var total;
        var sendDates = getJsonFromUrl();   
        var date1 = sendDates['startDate'];
        var date2 = sendDates['endDate'];
        if(date1 == "" || date1 == null) {
            date1 = "empty"        
        }
        if(date2 == "" || date2 == null) {
            date2 = "empty"        
        }
        document.getElementById("demo").innerHTML = "From : "+date1+" To : "+date2; 
       /*var date1 = document.getElementById('to').value;
        var date2 = document.getElementById('from').value;
        */
        /*var date1 = "2014-01-01";
          var date2 = "2014-07-01";
        */
        var req = new XMLHttpRequest();
        req.onload = function(e) {
        var raw_data = JSON.parse(req.response);
        var alerts = raw_data.alerts;  
        var start = alerts["start"] 
        var x = alerts["date"][0].split(" ");
        for (var i = 0;i < 100; i++) {
                count[i] = 0;
                bug_count[i] = 0;
        }

        for (var i = 1 ; i< alerts["date"].length -1 ; i++) {
           
            x1 = alerts["date"][i].split(" ");
           
           if(x1[0] == x[0]) {
             count[j] = count[j] + 1;
              if(alerts["bug"][i] != "")
             bug_count[j] = bug_count[j] + 1;
           }
           else {
               j = j+1;
           }
           x=x1;
        }
        if (date1 == "empty") {
            //date1 = "2014-07-13";
            var d = new Date()
            date1 = (d.getFullYear()+"-"+(d.getMonth()-2)+"-"+(d.getDate())).toString();            
        }
        var s = date1.split('-');
//        var dateObj1 = new Date(Number(s[0]),Number(s[1]) -1 ,Number(s[2]))
        var alphDate = new Date();        
        for(var i = 0 ; i <= 84;i = i + 7) {
                
                var dateObj1 = new Date(Number(s[0]),Number(s[1]) -1 ,Number(s[2])+i)
                alphDate.setDate(dateObj1 + 7);
                d2.push([(dateObj1).toString().split("00:")[0] , count[i]+count[i+1]+count[i+2]+count[i+3]+count[i+4]+count[i+5]+count[i+6]]);           
                d1.push([(dateObj1).toString().split("00:")[0] , bug_count[i]+bug_count[i+1]+bug_count[i+2]+bug_count[i+3]+bug_count[i+4]+bug_count[i+5]+bug_count[i+6]]);
                
        }
		$.plot("#placeholder", [ { data: d2, label: "Alerts"} , { data: d1, label: "Bugs"}], {
			series: {
				bars: {
					show: true,
					barWidth: 0.5,
					align: "center"
				}
			},
			xaxis: {
				mode: "categories",
				tickLength: 0
			}
		});

        }
        
        
        
		// Add the Flot version string to the footer
        req.open('get', 'http://54.215.155.53:8080/data/graph/flot?d1='+date1+'&d2='+date2, true);
        req.send();
	});
    
function getJsonFromUrl() {
  var query = location.search.substr(1);
  var data = query.split("&");
  var result = {};
  for(var i=0; i<data.length; i++) {
    var item = data[i].split("=");
    result[item[0]] = item[1];
  }
  return result;
}
	</script>
</head>
<body>

	<div id="header">
		<h2>Reports</h2>
        <p id="demo"></p>
	</div>
    <div align = "center">
    <form>
        <label for="from">Start date: </label>
        <input type="text" id="from" size="10" name="startDate"/>
        <label for="to">End date: </label>
        <input type="text" id="to" size="10" name="endDate"/>
        <input type="submit" value="Get data"/>
    </form>
    </div>
	<div id="content">

		<div class="demo-container">
			<div id="placeholder" class="demo-placeholder"></div>
		</div>

		<p align='center'>Alerts|Bugs Per Week</p>

	</div>


</body>
</html>





